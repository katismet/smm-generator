{% extends "base.html" %}
{% block title %}Post Generator — SMM Assistant{% endblock %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <h3 class="mb-3">Post Generator</h3>
        <form method="post">
          {{ form.hidden_tag() }}
          <div class="mb-3">
            <label class="form-label" for="tone">Tone:</label>
            {{ form.tone(id="tone", class_="form-control") }}
            {% for e in form.tone.errors %}<div class="form-text text-danger">{{ e }}</div>{% endfor %}
          </div>
          <div class="mb-3">
            <label class="form-label" for="topic">Topic:</label>
            {{ form.topic(id="topic", class_="form-control") }}
            {% for e in form.topic.errors %}<div class="form-text text-danger">{{ e }}</div>{% endfor %}
          </div>
          <div class="form-check mb-2">
            {{ form.generate_image(class_="form-check-input", id="genImg") }}
            <label class="form-check-label" for="genImg">Generate Image</label>
          </div>
          <div class="form-check mb-3">
            {{ form.auto_post(class_="form-check-input", id="autoVK") }}
            <label class="form-check-label" for="autoVK">Auto Post to VK</label>
          </div>
          {{ form.submit(class_="btn btn-primary", value="Generate") }}
        </form>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    {% if preview %}
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">{{ preview.title }}</h5>
          <p class="card-text" style="white-space:pre-wrap">{{ preview.text }}</p>
          {% if preview.hashtags %}<p class="mb-2"><span class="badge text-bg-secondary">{{ preview.hashtags }}</span></p>{% endif %}
          <details class="mb-2">
            <summary>Image prompt</summary>
            <pre class="mb-0" style="white-space:pre-wrap">{{ preview.image_prompt }}</pre>
          </details>
          {% if image_url %}
            <img class="img-fluid rounded border" src="{{ image_url }}" alt="preview">
          {% endif %}
          {% if vk_link %}
            <p class="mt-3 mb-0">Опубликовано во VK: <a href="{{ vk_link }}" target="_blank">{{ vk_link }}</a></p>
          {% else %}
            <p class="mt-3 mb-0 text-body-secondary">Пост пока не опубликован. Включите «Auto Post to VK», если хотите публиковать автоматически.</p>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="card border-0 bg-body-secondary-subtle h-100">
        <div class="card-body d-flex align-items-center justify-content-center text-body-secondary">
          <div class="text-center">
            <div class="mb-2">Здесь появится превью поста</div>
            <small>Заполните поля слева и нажмите Generate</small>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
